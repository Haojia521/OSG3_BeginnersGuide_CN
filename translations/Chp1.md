# 1 开启OpenSceneGraph之旅

> 在查看各种渲染效果和使用精心挑选的代码片段之前，让我们先了解一下OpenSceneGraph的历史，了解它的结构和功能，并加入社区来在线学习和讨论OSG。你将有机会创建一个OSG风格的“Hello World”应用程序，通过它你可以获得关于OSG语法和结构的必要信息。
>
> 本书中，**OSG** 为 **OpenSceneGraph** 的简写。为简便起见，本书主要使用简写。

在本章，我们将：

* 简要概述场景图概念和OSG的历史
* 了解最新版OSG的基本结构与特性 *（译者注：此处最新版指OSG3.0）*
* 使用一段简单代码亲身体验OSG
* 建立与OSG社区交互的连接

## 1.1 渲染中间件简明概览

在进入OSG的世界之前，假设你已经体验过OpenGL编程了。无论你是享受其中还是感到万分痛苦，你都要使用成堆的矩阵、设置管线状态、查找新的扩展、调用渲染API或命令，并立即在上下文中将数据绘制出来。

渲染中间件是提高抽象级别、以一定灵活性为代价来降低使用低级OpenGL API复杂性的解决方案。在用户程序中，模块化和面向对象的概念经常被应用于管理图元、材质和不同可视化数据集，这节省了大量的开发时间并允许新的功能可以按模块或插件的形式添加进来。

OSG是一款拥有良好设计的渲染中间件应用程序。它实际上是基于 **场景图** 原理的 **保留渲染**（或称延迟渲染）系统，在缓冲区记录渲染命令和数据并在其他时间执行。这允许系统在渲染之前执行各种优化操作，并可实现一个多线程策略来处理复杂场景。

## 1.2 场景图

**场景图** 是一个通用的数据结构，为了图形数据的高效管理和渲染它定义了图形场景的空间与逻辑关系。它是典型的层级图，包含一个顶级 **根节点**，若干能拥有任意数量 **子节点** 的 **组节点**，和一些没有子节点的 **叶节点**，叶节点组成树结构的最底一层。一个典型的场景图不允许存在环结构（一些节点连接成一个闭合链）或孤立元素（一个节点没有子节点或父节点）；

每个 **组节点** 可以拥有任意数量的孩子。将这些 **子节点** 组织在一起可以使它们共享父节点的信息，并能将它们视为一个整体。默认情况下，由父节点执行的操作会将其效果传递给所有孩子。

同样地，某些节点会有多个 **父节点**，此时这些节点被认为是“实体 (instanced)”，并且 **场景图** 可以被定义为 **有向无环图**。实例化 (instancing)产生了许多有趣的效果，包括数据共享和多通道渲染。

场景图的概念被广泛应用于许多现代化软件和应用程序中，例如AutoCAD、Maya、CorelDraw、VRML、Open Inventor和我们将要研究的——OpenSceneGraph。

## 1.3 OSG测诞生与发展

OpenSceneGraph项目是由Don Burns在1998年发起的。他曾为SGI工作，是一名滑翔爱好者。他在一个简易的Linux PC上写了一个简化的类SGI的 **场景图** API，命名为SG，这就是OSG的原型。

1999年，一位滑翔机制造商的设计顾问Robert Osfield开始参与这个年轻的项目。他建议将SG作为一个独立的 **开源** 项目继续开发，并很快将其元素移植到Windows中。那年年底，Robert接手了这个项目，并把它的名字改成了OpenSceneGraph。然后该项目被完全重写，以充分利用C++标准和设计模式。

2001年，为了回应人们对该项目日益增长的兴趣，Robert设立了公司 *OpenSceneGraph Professional Services*。他放弃了其他工作的机会，并全职提供商业和免费的OSG服务。Don也成立了自己的公司，*Andes Computer Engineering*，继续支持OSG的发展。

同年，在SIGGRAPH 2001大会期间举行了第一次OSG兴趣小组(BOF)会议，当时仅有12人参加。在那之后，OSG BOF的出席率每年都在增长，越来越多的人开始了解这个基于opengl的API。

2003年，起初为满足用户需要而创建以提供窗口和多管线图形系统集成能力的 **Producer** 库被添加进来，同时添加的还有另外两个重要的库，**osgText** 和 **osgFX**。随后在2005年，OSG 1.0发布，这成为邮件列表中1100多名成员的一大乐事。

2007年，发布了全新的OSG 2.0版本，提升了多核心、多CPU的支持，并添加了三个新库：**osgViewer**、**osgManipulator** 和 **osgShadow**。从那时起，开始使用统一构建系统CMake来简化项目工程构建过程。原 **Perducer** 被废弃并由 *Andes Computer Engineering* 公司作为独立项目进行维护。最早的两本关于OSG的图书 *OpenSceneGraph Quick Start Guide* 和 *OpenSceneGraph Reference Manuals* 也出版了。Paul Martz推荐所有场景图技术的新手开发者去阅读它们。

时间飞逝！一年又一年过去了，OSG一直保持着惊人的速度在发展：**osgWidget** 在2008年首次被引入；2009年 **osgVolume** 和 **osgAnimation** 出现；2010年伴随着即将发布的3.0版本 **osgQt** 诞生，同时还有令人惊叹的对OpenGL ES和OpenGL 3.0的支持。

现在，成百上千的高性能应用程序正在使用OSG渲染复杂场景和管理海量数据。在432个核心贡献者的巨大努力和世界各地软件开发人员的持续支持下，可以预见到OSG将会有一个非常光明的未来。

## 1.4 组件

OSG的基础结构具有高度的可伸缩性，以便能够在行运行时访问扩展功能。